/* Lazyvideo v1.0.0 Copyright 2014 Lazy Bear Creations */
(function(c,h,b,e){function d(a,g){this.node=a;this.$node=c(a);this.options=c.extend({},d._defaults,g);this.options.fullscreen=(b.fullscreenEnabled||b.mozFullScreenEnabled||b.webkitFullscreenEnabled)&&this.options.fullscreen;this.init()}d._defaults={fade:!0,fullscreen:!0,rewind:!1,forward:!1,timer:!1,volume:!0,draggable:!0,skipRate:0.5,progress:!0};d.prototype.init=function(){this.volume=this.node.volume;this.build()};d.prototype.build=function(){var a="lazyvideo-player-"+Math.floor(1E8*Math.random()+1);this.container=c(b.createElement("div")).attr("id",a).addClass("lazyvideo-player ready");this.$node.attr("width")&&this.container.width(this.$node.attr("width"));this.$node.attr("height")&&this.container.height(this.$node.attr("height"));this.$node.wrapAll(this.container);this.container=c("#"+a);this.overlay=c(b.createElement("div")).addClass("overlay");this.$node.after(this.overlay);this.loading=c(b.createElement("div")).addClass("loading fa fa-spinner fa-spin");this.play_me=c(b.createElement("div")).addClass("play-me fa fa-play pointer").hide();this.overlay.append(this.loading);this.overlay.append(this.play_me);if(3===this.node.networkState)return this.show_error("Error retrieving "+this.node.src),!1;this.$node.attr("controls")||this.build_controls()};d.prototype.build_controls=function(){this.controls={};this.controls.$node=c(b.createElement("div")).addClass("controls").hide();this.$node.after(this.controls.$node);this.options.progress&&(this.controls.video_progress=c(b.createElement("div")).addClass("control video-progress"),this.controls.video_tracker=c(b.createElement("div")).addClass("tracker"),this.controls.video_progress.html(this.controls.video_tracker),this.controls.$node.append(this.controls.video_progress));this.options.rewind&&(this.controls.rewind=c(b.createElement("div")).addClass("control btn btn-backward fa fa-backward"),this.controls.$node.append(this.controls.rewind));this.controls.play=c(b.createElement("div")).addClass("control btn btn-play fa fa-play");this.controls.$node.append(this.controls.play);this.options.forward&&(this.controls.forward=c(b.createElement("div")).addClass("control btn btn-forward fa fa-forward"),this.controls.$node.append(this.controls.forward));this.options.fullscreen&&(this.controls.expand=c(b.createElement("div")).addClass("control btn btn-fullscreen fa fa-expand"),this.controls.$node.append(this.controls.expand));this.options.timer&&(this.controls.timer=c(b.createElement("div")).addClass("control fa timer").html("00:00"),this.controls.$node.append(this.controls.timer));this.options.volume&&(this.controls.volume_btn=c(b.createElement("div")).addClass("control btn btn-volume fa fa-volume-up"),this.controls.$node.append(this.controls.volume_btn),this.controls.volume_bar=c(b.createElement("div")).addClass("control volume-bar"),this.controls.volume_tracker=c(b.createElement("div")).addClass("tracker"),this.controls.volume_bar.html(this.controls.volume_tracker),this.controls.$node.append(this.controls.volume_bar));this.events();this.options.fade&&this.fade_controls()};d.prototype.fade_controls=function(){var a=this;clearTimeout(a.controls.fade);return a.container.hasClass("ready")?!1:a.controls.fade=setTimeout(function(){a.controls.$node.fadeOut()},1500)};d.prototype.fullscreen=function(){var a=b.fullscreenElement||b.mozFullScreenElement||b.webkitFullscreenElement;this.options.fullscreen&&!a?(this.node.requestFullScreen?this.node.requestFullScreen():this.node.mozRequestFullScreen?this.node.mozRequestFullScreen():this.node.webkitRequestFullScreen&&this.node.webkitRequestFullScreen(),this.container.addClass("fullscreen")):(b.exitFullscreen?b.exitFullscreen():b.mozCancelFullScreen?b.mozCancelFullScreen():b.webkitCancelFullScreen&&b.webkitCancelFullScreen(),this.container.removeClass("fullscreen"));return!0};d.prototype.rewind=function(){var a=this;return setInterval(function(){a.jump(a.node.currentTime-a.options.skipRate)},100)};d.prototype.forward=function(){var a=this;return setInterval(function(){a.jump(a.node.currentTime+a.options.skipRate)},100)};d.prototype.jump=function(a){this.node.currentTime=a};d.prototype.events=function(){var a=this,d=function(){a.$node.add(a.controls.$node).off("mousemove");a.$node.on("mousemove",function(){clearTimeout(a.controls.fade);a.controls.$node.fadeIn();a.options.fade&&a.fade_controls()})};a.overlay.click(function(){a.play_me.is(":visible")&&(a.node.play(),c(this).fadeOut(),a.controls.$node.fadeIn(),a.play_me.hide(),a.loading.show(),d(),a.options.fade&&(a.controls.$node.on("mouseenter",function(){clearTimeout(a.controls.fade);a.controls.$node.fadeIn()}),a.$node.add(a.controls.$node).on("mouseleave",function(){clearTimeout(a.controls.fade);a.fade_controls()})))});a.$node.on("canplay",function(){a.loading.hide();a.play_me.show()});a.$node.on("seeking",function(){a.overlay.fadeIn()});a.$node.on("seeked",function(){a.overlay.fadeOut()});a.$node.on("error",function(){a.show_error("The media type is not supported by this browser");return!1});a.$node.on("timeupdate",function(b){if(a.options.timer){b=Math.floor(a.node.currentTime/60).toString();var c=Math.floor(a.node.currentTime-60*b).toString();b=2>b.length?"0"+b:b;c=2>c.length?"0"+c:c;a.timer=60<a.node.currentTime?b:0;a.timer+=":"+c;a.controls.timer.html(a.timer)}a.controls.video_tracker.css({width:a.node.currentTime/a.node.duration*100+"%"})});a.controls.play.on("click",function(){c(this).hasClass("fa-play")?a.node.play():a.node.pause()});a.$node.on("play",function(){a.playing=!0;a.controls.play.removeClass("fa-play").addClass("fa-pause");a.container.attr("class","lazyvideo-player playing")});a.$node.on("pause",function(){a.playing=!1;a.controls.play.removeClass("fa-pause").addClass("fa-play");a.container.attr("class","lazyvideo-player played")});a.controls.volume_btn.on("click",function(){a.node.volume=0<a.node.volume?0:0===a.volume?1:a.volume});a.controls.volume_bar.add(a.controls.volume_tracker).on("mousedown",function(b){var c=(b.pageX-a.controls.volume_bar.offset().left)/a.controls.volume_bar.width()*100/100;a.node.volume=a.volume=c;a.$node.add(a.controls.$node).on("mousemove",function(d){d=(d.pageX-b.pageX)/100+c;a.node.volume=0>d?a.volume=0:1<d?a.volume=1:a.volume=d;return!1})});a.$node.add(a.controls.$node).on("mouseup",function(){d()});a.$node.on("volumechange",function(){a.controls.volume_tracker.css({width:100*a.node.volume+"%"});0<a.node.volume?a.controls.volume_btn.attr("class","control btn btn-volume fa fa-volume-down"):a.controls.volume_btn.attr("class","control btn btn-volume fa fa-volume-off");0.5<a.node.volume&&a.controls.volume_btn.attr("class","control btn btn-volume fa fa-volume-up")});c(b).on("fullscreenchange mozfullscreenchange webkitfullscreenchange",function(c){c=b.fullscreenElement||b.mozFullScreenElement||b.webkitFullscreenElement;a.options.fullscreen&&c?a.controls.expand.removeClass("fa-expand").addClass("fa-compress"):a.controls.expand.removeClass("fa-compress").addClass("fa-expand")});if(a.options.fullscreen)a.controls.expand.on("click",function(){a.fullscreen()});a.options.rewind&&(a.controls.rewind.on("mousedown",function(){a.jump(a.node.currentTime-a.options.skipRate);a.seeker=a.rewind()}),a.controls.rewind.on("mouseup mouseleave",function(){clearInterval(a.seeker)}));a.options.forward&&(a.controls.forward.on("mousedown",function(){a.jump(a.node.currentTime+a.options.skipRate);a.seeker=a.forward()}),a.controls.forward.on("mouseup mouseleave",function(){clearInterval(a.seeker)}));a.controls.video_progress.add(a.controls.video_tracker).on("mousedown",function(b){b=(b.pageX-a.controls.video_progress.offset().left)/a.controls.video_progress.width()*100;a.controls.video_tracker.css({width:b+"%"});a.jump(b/100*a.node.duration)})};d.prototype.show_error=function(a){a=a===e?"An error has occured":a;this.container.css({"padding-top":this.container.height()/2}).html(a);this.$node.hide()};c.fn.lazyvideo=function(a){return this.each(function(){var b=c(this),f=b.data("lazyvideo"),e="object"==typeof a&&a;f||b.data("lazyvideo",f=new d(this,e));if("string"==typeof a)f[a]()})};c.fn.lazyvideo.Constructor=d;c(b).ready(function(){c(".lazyvideo").each(function(){var a=c(this);a.lazyvideo(a.data())})})})(jQuery,window,document,void 0);